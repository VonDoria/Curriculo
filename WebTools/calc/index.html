<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Riqueza</title>
    <link rel="icon" href="logocalc.png">
    <meta name="theme-color" content="#f8fafc">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* Fonte Padrão */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate-50 */
            color: #334155; /* Slate-700 */
        }

        /* Classes Utilitárias de UI para Reuso (do template) */
        .card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0; /* slate-200 */
            transition: all 0.3s ease;
        }

        .section-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 700;
            color: #1e293b; /* slate-800 */
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        /* Inputs Padronizados (do template) */
        .input-std {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            outline: none;
            transition: all 0.2s;
        }
        .input-std:focus {
            border-color: #6366f1; /* Indigo-500 */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* Botões de Gráfico (do template) */
        .chart-btn.active {
            background-color: #6366f1; /* indigo-500 */
            color: white;
            border-color: #6366f1;
        }
        .chart-btn {
            background-color: #f1f5f9; /* slate-100 */
            color: #64748b; /* slate-500 */
        }

        /* Botões Padronizados (do template) */
        .btn {
            padding: 0.625rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .btn-primary { background-color: #6366f1; color: white; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-1px); }
        
        .btn-secondary { background-color: #64748b; color: white; }
        .btn-secondary:hover { background-color: #475569; transform: translateY(-1px); }

        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; transform: translateY(-1px); }
        
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; transform: translateY(-1px); }

        /* Navegação (Tabs) - Estilo Clean (do template) */
        .tabs-container {
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        
        .tab {
            padding: 1rem 0.75rem;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            font-size: 0.875rem;
            color: #64748b;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            transition: color 0.2s, border-color 0.2s;
        }
        .tab:hover { 
            color: #334155;
            border-bottom-color: #cbd5e1;
        }
        .tab.active {
            color: #6366f1; /* Indigo-600 */
            border-bottom-color: #6366f1;
        }
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .tab-content.active { display: block; opacity: 1; }

        /* Tutorial Accordion (do template) */
        details summary { cursor: pointer; list-style: none; }
        details summary::-webkit-details-marker { display: none; }
        details summary .arrow { transition: transform 0.2s; }
        details[open] summary .arrow { transform: rotate(90deg); }
        .tutorial-step { transition: background-color 0.2s; }
        .tutorial-step:hover { background-color: #f8fafc; }

        /* Estilos específicos da calculadora financeira */
        .currency-input-wrapper {
            position: relative;
            flex-grow: 1;
        }
        .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-weight: 500;
        }
        .input-with-symbol {
            padding-left: 2.5rem !important;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #6366f1;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #6366f1;
        }

        /* Estilos da Calculadora Básica */
        .calc-btn {
            height: 3.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1.125rem;
            transition: all 0.15s ease;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .calc-btn:active {
            transform: scale(0.95);
        }
        .calc-btn-num {
            background-color: white;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }
        .calc-btn-num:hover { background-color: #f8fafc; }
        
        .calc-btn-op {
            background-color: #f1f5f9;
            color: #4f46e5;
            border: 1px solid #cbd5e1;
        }
        .calc-btn-op:hover { background-color: #e2e8f0; }

        .calc-btn-eq {
            background-color: #4f46e5;
            color: white;
        }
        .calc-btn-eq:hover { background-color: #4338ca; }

        .calc-btn-danger {
            background-color: #fee2e2;
            color: #ef4444;
            border: 1px solid #fecaca;
        }
        .calc-btn-danger:hover { background-color: #fecaca; }

        /* Cards de aportes/saques múltiplos */
        .transaction-card {
            transition: all 0.2s ease;
        }
        .transaction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl min-h-screen flex flex-col">
        
        <header class="text-center mb-8 p-6 bg-white rounded-xl shadow-md border border-slate-200">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 flex items-center justify-center gap-3">
                <i class="ph-bold ph-wallet text-indigo-500"></i>
                <span id="app-title">Calculadora de Riqueza</span>
            </h1>
            <p class="text-slate-500 mt-2">Simule o poder dos juros compostos e planeje sua liberdade financeira.</p>
        </header>

        <!-- NAVEGAÇÃO (padrão template) -->
        <div class="mb-6 border-b border-slate-200 tabs-container">
            <nav class="flex -mb-px space-x-6" aria-label="Tabs">
                <button class="tab active" data-tab="simulator">
                    <i class="ph-bold ph-sliders"></i> Simulador
                </button>
                <button class="tab" data-tab="analysis">
                    <i class="ph-bold ph-chart-pie-slice"></i> Extrato
                </button>
                <button class="tab" data-tab="basic-calc">
                    <i class="ph-bold ph-calculator"></i> Calculadora
                </button>
                <button class="tab" data-tab="tutorial">
                    <i class="ph-bold ph-book-open"></i> Tutorial
                </button>
                <button class="tab" data-tab="settings">
                    <i class="ph-bold ph-gear"></i> Configurações
                </button>
            </nav>
        </div>

        <main class="flex-grow">
            
            <!-- Aba Simulador -->
            <div id="simulator-tab" class="tab-content active space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    <!-- Coluna de Configuração (Esquerda) -->
                    <div class="lg:col-span-4 space-y-6">
                        <div class="card">
                            <h2 class="section-title"><i class="ph-bold ph-gear-six text-indigo-500"></i> Configuração Base</h2>
                            
                            <div class="space-y-4">
                                <!-- Inicial -->
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Investimento Inicial</label>
                                    <div class="currency-input-wrapper">
                                        <span class="currency-symbol">R$</span>
                                        <input type="number" id="initialAmount" class="input-std input-with-symbol" placeholder="0,00" step="0.01" value="1000">
                                    </div>
                                </div>

                                <!-- Taxa -->
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Rentabilidade Anual (%)</label>
                                    <input type="number" id="interestRate" class="input-std" placeholder="10" step="0.1" value="10">
                                </div>

                                <!-- Tempo Flexível -->
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Duração do Planejamento</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="periodValue" class="input-std" placeholder="30" value="10">
                                        <select id="periodUnit" class="input-std bg-slate-50">
                                            <option value="years">Anos</option>
                                            <option value="months">Meses</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Inflação -->
                                <div class="pt-4 border-t border-slate-100 flex items-center justify-between">
                                    <div class="text-sm">
                                        <span class="font-medium text-slate-700">Ajustar pela Inflação?</span>
                                        <p class="text-xs text-slate-500">Exibe valores em poder de compra atual</p>
                                    </div>
                                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                        <input type="checkbox" id="inflationToggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300"/>
                                        <label for="inflationToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer transition-colors duration-300"></label>
                                    </div>
                                </div>
                                <div id="inflationInputContainer" class="hidden mt-2">
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Inflação Projetada (%)</label>
                                    <input type="number" id="inflationRate" class="input-std" value="4.5" step="0.1">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Card Aportes Múltiplos -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="section-title"><i class="ph-bold ph-plus-circle text-emerald-500"></i> Aportes Periódicos</h2>
                                <button id="addContributionBtn" class="px-3 py-1 bg-emerald-100 text-emerald-600 rounded-lg text-sm font-semibold hover:bg-emerald-200 transition">
                                    <i class="ph-bold ph-plus"></i> Adicionar
                                </button>
                            </div>
                            <div id="contributionsList" class="space-y-3">
                                <!-- Aportes serão adicionados dinamicamente -->
                            </div>
                        </div>

                        <!-- Card Saques Múltiplos -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="section-title"><i class="ph-bold ph-minus-circle text-red-500"></i> Saques Programados</h2>
                                <button id="addWithdrawalBtn" class="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm font-semibold hover:bg-red-200 transition">
                                    <i class="ph-bold ph-plus"></i> Adicionar
                                </button>
                            </div>
                            <div id="withdrawalsList" class="space-y-3">
                                <!-- Saques serão adicionados dinamicamente -->
                            </div>
                        </div>

                        <!-- Botão Calcular -->
                        <button id="calculateBtn" class="btn btn-primary w-full py-3 rounded-lg font-bold flex items-center justify-center gap-2">
                            <i class="ph-bold ph-play"></i> Projetar Futuro
                        </button>
                    </div>

                    <!-- Coluna Central: Gráficos -->
                    <div class="lg:col-span-8 space-y-6">
                        <!-- Gráfico Principal -->
                        <div class="card">
                            <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                                <h2 class="section-title mb-0"><i class="ph-bold ph-chart-bar text-indigo-500"></i> Evolução Patrimonial</h2>
                                
                                <!-- Controles do Gráfico (padrão template) -->
                                <div class="flex bg-slate-100 p-1 rounded-lg">
                                    <button class="chart-btn active px-3 py-1.5 rounded-md text-xs font-semibold flex items-center gap-1 transition-all" data-type="line">
                                        <i class="ph-bold ph-chart-line"></i> Linhas
                                    </button>
                                    <button class="chart-btn px-3 py-1.5 rounded-md text-xs font-semibold flex items-center gap-1 transition-all" data-type="bar">
                                        <i class="ph-bold ph-chart-bar"></i> Colunas
                                    </button>
                                </div>
                            </div>
                            <div class="h-[350px] w-full relative">
                                <canvas id="mainChart"></canvas>
                            </div>
                            
                            <!-- Resumo Rápido -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-slate-100 text-center">
                                <div>
                                    <p class="text-xs text-slate-500 uppercase font-semibold">Saldo Final</p>
                                    <p id="resTotal" class="text-xl font-bold text-indigo-600">R$ 0,00</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-500 uppercase font-semibold">Total Aportado</p>
                                    <p id="resInvested" class="text-lg font-semibold text-slate-700">R$ 0,00</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-500 uppercase font-semibold">Total Juros</p>
                                    <p id="resInterest" class="text-lg font-semibold text-emerald-600">R$ 0,00</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-500 uppercase font-semibold">Total Sacado</p>
                                    <p id="resWithdrawn" class="text-lg font-semibold text-red-500">R$ 0,00</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Gráfico Fluxo -->
                            <div class="card">
                                <h2 class="section-title"><i class="ph-bold ph-arrows-left-right text-indigo-500"></i> Fluxo de Caixa Acumulado</h2>
                                <div class="h-[300px]">
                                    <canvas id="flowChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Gráfico Composição -->
                            <div class="card">
                                <h2 class="section-title"><i class="ph-bold ph-chart-pie-slice text-indigo-500"></i> Composição Final</h2>
                                <div class="h-[300px] flex justify-center">
                                    <canvas id="pieChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Extrato -->
            <div id="analysis-tab" class="tab-content space-y-6">
                <div class="card">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                        <h2 class="section-title"><i class="ph-bold ph-list-dashes text-slate-600"></i> Extrato Detalhado</h2>
                        <button id="copyCsvButton" class="btn btn-secondary">
                            <i class="ph-bold ph-microsoft-excel-logo"></i> Exportar CSV
                        </button>
                    </div>
                    <div class="overflow-x-auto max-h-[600px] overflow-y-auto border rounded-lg border-slate-200">
                        <table class="w-full text-left border-collapse text-sm">
                            <thead class="bg-slate-50 sticky top-0 shadow-sm z-10">
                                <tr>
                                    <th class="p-3 font-semibold text-slate-600 border-b">Período</th>
                                    <th class="p-3 font-semibold text-slate-600 border-b text-right">Rendimentos</th>
                                    <th class="p-3 font-semibold text-slate-600 border-b text-right text-emerald-600">Aportes</th>
                                    <th class="p-3 font-semibold text-slate-600 border-b text-right text-red-500">Saques</th>
                                    <th class="p-3 font-semibold text-slate-600 border-b text-right bg-slate-100">Saldo Total</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="divide-y divide-slate-100">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Aba Calculadora Básica -->
            <div id="basic-calc-tab" class="tab-content">
                <div class="flex justify-center items-center py-4">
                    <div class="card w-full max-w-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="section-title mb-0"><i class="ph-bold ph-calculator text-indigo-500"></i> Calculadora</h2>
                            <span class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">Básico</span>
                        </div>
                        
                        <!-- Visor -->
                        <div class="mb-4">
                            <input type="text" id="calcDisplay" readonly 
                                class="w-full h-16 text-right text-3xl font-mono p-4 bg-slate-800 text-emerald-400 rounded-lg border-2 border-slate-700 shadow-inner outline-none tracking-widest cursor-pointer hover:bg-slate-700 transition"
                                value="0"
                                title="Clique para copiar o resultado">
                        </div>

                        <!-- Teclado -->
                        <div class="grid grid-cols-4 gap-3">
                            <button class="calc-btn calc-btn-danger" onclick="calcClear()">C</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput('(')">(</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput(')')">)</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput('/')">÷</button>
                            
                            <button class="calc-btn calc-btn-num" onclick="calcInput('7')">7</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('8')">8</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('9')">9</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput('*')">×</button>
                            
                            <button class="calc-btn calc-btn-num" onclick="calcInput('4')">4</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('5')">5</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('6')">6</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput('-')">-</button>
                            
                            <button class="calc-btn calc-btn-num" onclick="calcInput('1')">1</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('2')">2</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('3')">3</button>
                            <button class="calc-btn calc-btn-op" onclick="calcInput('+')">+</button>
                            
                            <button class="calc-btn calc-btn-num" onclick="calcInput('0')">0</button>
                            <button class="calc-btn calc-btn-num" onclick="calcInput('.')">.</button>
                            <button class="calc-btn calc-btn-op" onclick="calcBackspace()"><i class="ph-bold ph-backspace"></i></button>
                            <button class="calc-btn calc-btn-eq" onclick="calcResult()">=</button>
                        </div>
                        <p class="text-xs text-center text-slate-400 mt-4">Use para contas rápidas de juros ou frações. Clique no visor para copiar resultado.</p>
                    </div>
                </div>
            </div>

            <!-- Aba de Tutorial -->
            <div id="tutorial-tab" class="tab-content">
                <div class="card space-y-6">
                    <div>
                        <h2 class="section-title"><i class="ph-bold ph-graduation-cap text-indigo-500"></i> Como usar esta ferramenta</h2>
                        <p class="text-slate-600 mb-4">Bem-vindo! Esta calculadora salva suas simulações automaticamente no seu navegador. Siga os passos abaixo:</p>
                    </div>

                    <div class="space-y-3">
                        <details class="bg-slate-50 p-4 rounded-lg border border-slate-200 tutorial-step">
                            <summary class="font-semibold text-slate-800 flex justify-between items-center">
                                <span>1. Configurando a Simulação</span>
                                <i class="ph ph-caret-right arrow text-slate-400"></i>
                            </summary>
                            <div class="pt-3 mt-3 border-t border-slate-200 text-slate-600 text-sm">
                                <p>Vá até a aba "Simulador". Configure o investimento inicial, rentabilidade anual e duração do planejamento. Ative o ajuste pela inflação para ver valores em poder de compra atual.</p>
                            </div>
                        </details>

                        <details class="bg-slate-50 p-4 rounded-lg border border-slate-200 tutorial-step">
                            <summary class="font-semibold text-slate-800 flex justify-between items-center">
                                <span>2. Adicionando Aportes e Saques</span>
                                <i class="ph ph-caret-right arrow text-slate-400"></i>
                            </summary>
                            <div class="pt-3 mt-3 border-t border-slate-200 text-slate-600 text-sm">
                                <p>Adicione múltiplos aportes periódicos e saques programados. Cada transação pode ter valor e frequência diferentes. Clique em "Projetar Futuro" para atualizar os gráficos.</p>
                            </div>
                        </details>

                        <details class="bg-slate-50 p-4 rounded-lg border border-slate-200 tutorial-step">
                            <summary class="font-semibold text-slate-800 flex justify-between items-center">
                                <span>3. Analisando Resultados</span>
                                <i class="ph ph-caret-right arrow text-slate-400"></i>
                            </summary>
                            <div class="pt-3 mt-3 border-t border-slate-200 text-slate-600 text-sm">
                                <p>A aba "Extrato" mostra uma tabela detalhada mês a mês. A aba "Simulador" mostra gráficos visuais da evolução patrimonial, fluxo de caixa e composição final.</p>
                            </div>
                        </details>

                        <details class="bg-slate-50 p-4 rounded-lg border border-slate-200 tutorial-step">
                            <summary class="font-semibold text-slate-800 flex justify-between items-center">
                                <span>4. Salvando e Sincronizando</span>
                                <i class="ph ph-caret-right arrow text-slate-400"></i>
                            </summary>
                            <div class="pt-3 mt-3 border-t border-slate-200 text-slate-600 text-sm">
                                <p>Suas simulações são salvas automaticamente. Na aba "Configurações", você pode exportar dados para outro dispositivo ou importar simulações anteriores.</p>
                            </div>
                        </details>
                    </div>
                    
                    <div class="border-t pt-6 mt-6 text-center text-slate-600">
                        <h3 class="font-semibold text-lg text-slate-800">Uma mensagem do criador</h3>
                        <p class="mt-2">Esta ferramenta foi desenvolvida para ajudar no planejamento financeiro pessoal, tornando complexos cálculos de juros compostos em algo visual e intuitivo. O objetivo é facilitar a tomada de decisões sobre investimentos e aposentadoria.</p>
                        <p class="mt-2">Se esta ferramenta te ajudou a entender melhor suas finanças e a planejar seu futuro, considere compartilhá-la com outras pessoas que também possam se beneficiar!</p>
                    </div>
                </div>
            </div>

            <!-- Aba Configurações -->
            <div id="settings-tab" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <div class="card">
                        <h2 class="section-title"><i class="ph-bold ph-floppy-disk text-indigo-500"></i> Gerenciar Simulações</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Nome da Simulação</label>
                                <input type="text" id="simulationName" class="input-std" placeholder="Ex: Plano Aposentadoria">
                            </div>
                            
                            <button id="saveSimulationBtn" class="btn btn-primary w-full">
                                <i class="ph-bold ph-floppy-disk"></i> Salvar Simulação Atual
                            </button>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Carregar Simulação</label>
                                <select id="loadSimulationSelect" class="input-std bg-slate-50">
                                    <option value="">Selecione uma simulação...</option>
                                </select>
                                <button id="loadSimulationBtn" class="btn btn-secondary w-full mt-2">
                                    <i class="ph-bold ph-upload"></i> Carregar Simulação
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="section-title"><i class="ph-bold ph-arrows-left-right text-emerald-500"></i> Sincronização de Dados</h2>
                        
                        <div class="space-y-4">
                            <!-- Área de Exportação -->
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Exportar (Backup)</label>
                                <button id="exportDataBtn" class="btn btn-success w-full">
                                    <i class="ph-bold ph-export"></i> Copiar Dados para Transferência
                                </button>
                                <p class="text-xs text-slate-400 mt-1">Copia todo o estado da aplicação para a área de transferência.</p>
                            </div>
                            
                            <hr class="border-slate-100 my-2">

                            <!-- Área de Importação -->
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Importar (Restaurar)</label>
                                <textarea id="importDataTextarea" class="input-std h-24 resize-none font-mono text-xs" placeholder="Cole aqui o código JSON gerado na exportação..."></textarea>
                                <button id="importDataBtn" class="btn btn-secondary w-full mt-2">
                                    <i class="ph-bold ph-import"></i> Substituir e Importar
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </main>

        <!-- Barra de Armazenamento (padrão template) -->
        <footer class="mt-8">
            <div class="bg-white p-3 rounded-xl shadow-md border border-slate-200">
                <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
                    <div id="storageProgress" class="bg-indigo-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-slate-500 mt-2">
                    <span>Uso do Armazenamento Local</span>
                    <span id="storageText">0% (0 KB / 5 MB)</span>
                </div>
            </div>
        </footer>
        
        <!-- Container de Toasts (padrão template) -->
        <div id="toastContainer" class="fixed bottom-24 sm:bottom-5 left-5 w-full max-w-xs z-50 pointer-events-none"></div>
        
    </div>

    <script>
        /**
         * CONFIGURAÇÃO GLOBAL (padrão template)
         * Defina aqui a chave única para evitar colisão de dados com outras apps.
         */
        const APP_KEY = 'FinanceCalc_v1_Data'; 
        
        // Estado Inicial Padrão
        const defaultState = {
            config: {
                initial: 1000,
                rate: 10,
                periodValue: 10,
                periodUnit: 'years',
                inflation: false,
                inflationRate: 4.5
            },
            contributions: [
                { amount: 500, freq: 1, id: 'contrib-1' }
            ],
            withdrawals: [
                { amount: 0, freq: 0, id: 'withdraw-1' }
            ],
            chartType: 'line',
            results: []
        };

        // Estado Reativo (Carregado na inicialização) - padrão template
        let appState = JSON.parse(JSON.stringify(defaultState));
        let mainChartInstance = null;
        let flowChartInstance = null;
        let pieChartInstance = null;

        // --- SISTEMA DE ARMAZENAMENTO (padrão template) ---

        function saveData() {
            try {
                const serialized = JSON.stringify(appState);
                localStorage.setItem(APP_KEY, serialized);
                updateStorageBar();
            } catch (e) {
                showToast('Erro ao salvar dados (LocalStorage cheio?)', 'error');
            }
        }

        function loadData() {
            const raw = localStorage.getItem(APP_KEY);
            if (raw) {
                try {
                    const parsed = JSON.parse(raw);
                    appState = { ...parsed };
                } catch (e) {
                    console.error("Dados corrompidos, usando padrão.");
                }
            }
            updateUI();
        }

        function updateStorageBar() {
            const dataStr = JSON.stringify(localStorage);
            const size = new Blob([dataStr]).size;
            const limit = 5 * 1024 * 1024; // 5MB padrão
            const percent = Math.min(100, (size / limit) * 100);
            
            const bar = document.getElementById('storageProgress');
            const text = document.getElementById('storageText');
            
            bar.style.width = `${percent}%`;
            // Muda cor se estiver cheio
            if(percent > 90) bar.className = 'bg-red-500 h-2.5 rounded-full transition-all duration-500';
            else bar.className = 'bg-indigo-500 h-2.5 rounded-full transition-all duration-500';

            text.textContent = `${percent.toFixed(1)}% (${(size/1024).toFixed(0)} KB usados)`;
        }

        // --- SISTEMA DE UI / NAVEGAÇÃO (padrão template) ---

        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active de todos
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Ativa atual
                    tab.classList.add('active');
                    const targetId = tab.getAttribute('data-tab') + '-tab';
                    document.getElementById(targetId).classList.add('active');

                    // Se for aba de simulador, renderiza gráficos
                    if (tab.getAttribute('data-tab') === 'simulator') {
                        renderCharts();
                    }
                });
            });
        }

        function showToast(msg, type = 'info') {
            const container = document.getElementById('toastContainer');
            
            const colors = {
                success: 'bg-emerald-100 border-emerald-400 text-emerald-800',
                error: 'bg-red-100 border-red-400 text-red-800',
                info: 'bg-indigo-100 border-indigo-400 text-indigo-800'
            };
            const icons = {
                success: 'ph-check-circle',
                error: 'ph-warning-circle',
                info: 'ph-info'
            };

            const el = document.createElement('div');
            el.className = `pointer-events-auto flex items-center gap-3 p-4 rounded-lg shadow-lg border mb-3 transform transition-all duration-300 translate-x-[-100%] opacity-0 ${colors[type]}`;
            el.innerHTML = `<i class="ph-bold ${icons[type]} text-xl"></i><span class="font-medium text-sm">${msg}</span>`;
            
            container.appendChild(el);
            
            // Animação de entrada
            requestAnimationFrame(() => {
                el.classList.remove('translate-x-[-100%]', 'opacity-0');
            });

            // Auto remove
            setTimeout(() => {
                el.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        // --- LÓGICA DE NEGÓCIO (Calculadora Financeira) ---

        function calculate() {
            const { config } = appState;
            
            // Determinar total de meses
            const totalMonths = config.periodUnit === 'years' ? config.periodValue * 12 : config.periodValue;
            
            // Taxa mensal
            let annualRateDecimal = config.rate / 100;
            if (config.inflation) {
                const inflDecimal = config.inflationRate / 100;
                annualRateDecimal = ((1 + annualRateDecimal) / (1 + inflDecimal)) - 1;
            }
            const monthlyRate = Math.pow(1 + annualRateDecimal, 1/12) - 1;

            let balance = config.initial;
            let totalInvested = config.initial;
            let totalInterest = 0;
            let totalWithdrawn = 0;
            
            let principalBalance = config.initial;
            let interestBalance = 0;

            const timeline = [];

            for (let m = 1; m <= totalMonths; m++) {
                // 1. Render Juros sobre o saldo anterior
                const interestMonth = balance * monthlyRate;
                balance += interestMonth;
                interestBalance += interestMonth;
                totalInterest += interestMonth;

                // 2. Processar todos os aportes
                let totalContribution = 0;
                appState.contributions.forEach(contrib => {
                    if (contrib.freq > 0 && m % contrib.freq === 0) {
                        balance += contrib.amount;
                        principalBalance += contrib.amount;
                        totalInvested += contrib.amount;
                        totalContribution += contrib.amount;
                    }
                });

                // 3. Processar todos os saques
                let totalWithdrawal = 0;
                appState.withdrawals.forEach(withdraw => {
                    if (withdraw.freq > 0 && m % withdraw.freq === 0) {
                        balance -= withdraw.amount;
                        totalWithdrawn += withdraw.amount;
                        totalWithdrawal += withdraw.amount;
                        
                        // Deduzir dos juros primeiro, depois do principal
                        if (interestBalance >= withdraw.amount) {
                            interestBalance -= withdraw.amount;
                        } else {
                            const remaining = withdraw.amount - interestBalance;
                            interestBalance = 0;
                            principalBalance -= remaining;
                        }
                    }
                });

                timeline.push({
                    month: m,
                    balance: balance,
                    principalBalance: principalBalance,
                    interestBalance: interestBalance,
                    interestMonth: interestMonth,
                    contribution: totalContribution,
                    withdrawal: totalWithdrawal,
                    accInvested: totalInvested,
                    accWithdrawn: totalWithdrawn
                });
            }

            appState.results = timeline;
            saveData();
            updateUI();
            showToast('Simulação atualizada com sucesso!', 'success');
        }

        // --- FUNÇÕES DE APORTES/SAQUES MÚLTIPLOS ---

        function addContribution() {
            const id = 'contrib-' + Date.now();
            appState.contributions.push({ amount: 500, freq: 1, id });
            renderContributions();
            calculate();
        }

        function addWithdrawal() {
            const id = 'withdraw-' + Date.now();
            appState.withdrawals.push({ amount: 0, freq: 0, id });
            renderWithdrawals();
            calculate();
        }

        function removeContribution(id) {
            appState.contributions = appState.contributions.filter(c => c.id !== id);
            renderContributions();
            calculate();
        }

        function removeWithdrawal(id) {
            appState.withdrawals = appState.withdrawals.filter(w => w.id !== id);
            renderWithdrawals();
            calculate();
        }

        function updateContribution(id, field, value) {
            const contrib = appState.contributions.find(c => c.id === id);
            if (contrib) {
                contrib[field] = parseFloat(value) || 0;
                calculate();
            }
        }

        function updateWithdrawal(id, field, value) {
            const withdraw = appState.withdrawals.find(w => w.id === id);
            if (withdraw) {
                withdraw[field] = parseFloat(value) || 0;
                calculate();
            }
        }

        function renderContributions() {
            const container = document.getElementById('contributionsList');
            container.innerHTML = '';
            
            appState.contributions.forEach((contrib, index) => {
                const div = document.createElement('div');
                div.className = 'transaction-card bg-slate-50 p-3 rounded-lg border border-slate-200';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-700">Aporte ${index + 1}</span>
                        ${appState.contributions.length > 1 ? `<button onclick="removeContribution('${contrib.id}')" class="text-red-500 hover:text-red-700"><i class="ph-bold ph-trash"></i></button>` : ''}
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-slate-600">Valor</label>
                            <div class="currency-input-wrapper">
                                <span class="currency-symbol text-xs">R$</span>
                                <input type="number" value="${contrib.amount}" step="0.01" 
                                    class="input-std input-with-symbol text-sm"
                                    onchange="updateContribution('${contrib.id}', 'amount', this.value)">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-slate-600">Frequência (meses)</label>
                            <input type="number" value="${contrib.freq}" min="1"
                                class="input-std text-sm"
                                onchange="updateContribution('${contrib.id}', 'freq', this.value)">
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderWithdrawals() {
            const container = document.getElementById('withdrawalsList');
            container.innerHTML = '';
            
            appState.withdrawals.forEach((withdraw, index) => {
                const div = document.createElement('div');
                div.className = 'transaction-card bg-slate-50 p-3 rounded-lg border border-slate-200';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-700">Saque ${index + 1}</span>
                        ${appState.withdrawals.length > 1 ? `<button onclick="removeWithdrawal('${withdraw.id}')" class="text-red-500 hover:text-red-700"><i class="ph-bold ph-trash"></i></button>` : ''}
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-slate-600">Valor</label>
                            <div class="currency-input-wrapper">
                                <span class="currency-symbol text-xs">R$</span>
                                <input type="number" value="${withdraw.amount}" step="0.01" 
                                    class="input-std input-with-symbol text-sm"
                                    onchange="updateWithdrawal('${withdraw.id}', 'amount', this.value)">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-slate-600">Frequência (meses)</label>
                            <input type="number" value="${withdraw.freq}" min="0"
                                class="input-std text-sm"
                                onchange="updateWithdrawal('${withdraw.id}', 'freq', this.value)">
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- RENDERIZAÇÃO (padrão template adaptado) ---

        function updateUI() {
            if (appState.results.length === 0) return;
            const final = appState.results[appState.results.length - 1];

            // Formatadores
            const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
            
            document.getElementById('resTotal').textContent = formatCurrency(final.balance);
            document.getElementById('resInvested').textContent = formatCurrency(final.accInvested);
            document.getElementById('resInterest').textContent = formatCurrency(final.balance - final.principalBalance);
            document.getElementById('resWithdrawn').textContent = formatCurrency(final.accWithdrawn);

            renderTable();
            renderCharts();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
            
            let html = '';
            appState.results.forEach(r => {
                const isYearly = r.month % 12 === 0;
                if (appState.results.length <= 60 || isYearly || r.contribution > 0 || r.withdrawal > 0) {
                    html += `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50">
                            <td class="p-3 text-slate-700">${r.month}º Mês</td>
                            <td class="p-3 text-right text-slate-500 font-mono text-xs">+${formatCurrency(r.interestMonth)}</td>
                            <td class="p-3 text-right font-mono text-xs ${r.contribution > 0 ? 'text-emerald-600 font-bold' : 'text-slate-300'}">
                                ${r.contribution > 0 ? '+'+formatCurrency(r.contribution) : '-'}
                            </td>
                            <td class="p-3 text-right font-mono text-xs ${r.withdrawal > 0 ? 'text-red-500 font-bold' : 'text-slate-300'}">
                                ${r.withdrawal > 0 ? '-'+formatCurrency(r.withdrawal) : '-'}
                            </td>
                            <td class="p-3 text-right font-bold text-slate-800 bg-slate-50/50">${formatCurrency(r.balance)}</td>
                        </tr>
                    `;
                }
            });
            tbody.innerHTML = html;
        }

        function renderCharts() {
            renderMainChart();
            renderFlowChart();
            renderPieChart();
        }

        function renderMainChart() {
            const ctx = document.getElementById('mainChart');
            if (!ctx) return;
            
            if (mainChartInstance) mainChartInstance.destroy();

            const type = document.querySelector('.chart-btn.active').dataset.type;
            const formatCompact = (val) => new Intl.NumberFormat('pt-BR', { notation: "compact", maximumFractionDigits: 1 }).format(val);
            const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);

            const dataPoints = appState.results.length > 200 
                ? appState.results.filter((_, i) => i % Math.ceil(appState.results.length / 100) === 0)
                : appState.results;

            const labels = dataPoints.map(r => r.month % 12 === 0 ? `Ano ${r.month/12}` : `${r.month}m`);
            const isBar = type === 'bar';
            const datasets = [];
            
            if (isBar) {
                datasets.push({ 
                    label: 'Principal', 
                    data: dataPoints.map(r => r.principalBalance), 
                    backgroundColor: '#6366f1', 
                    order: 2, 
                    stack: 'Stack 0' 
                });
                datasets.push({ 
                    label: 'Juros', 
                    data: dataPoints.map(r => r.interestBalance), 
                    backgroundColor: '#10b981', 
                    order: 1, 
                    stack: 'Stack 0' 
                });
            } else {
                datasets.push({ 
                    label: 'Patrimônio Total', 
                    data: dataPoints.map(r => r.balance), 
                    borderColor: '#6366f1', 
                    backgroundColor: 'rgba(99, 102, 241, 0.1)', 
                    borderWidth: 3, 
                    fill: true, 
                    tension: 0.4, 
                    pointRadius: 0 
                });
                datasets.push({ 
                    label: 'Capital Próprio', 
                    data: dataPoints.map(r => r.principalBalance), 
                    borderColor: '#94a3b8', 
                    borderWidth: 2, 
                    borderDash: [5, 5], 
                    fill: false, 
                    tension: 0.4, 
                    pointRadius: 0 
                });
            }

            mainChartInstance = new Chart(ctx, {
                type: isBar ? 'bar' : 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: { 
                        x: { grid: { display: false } }, 
                        y: { 
                            stacked: isBar, 
                            grid: { color: '#f1f5f9' }, 
                            ticks: { callback: (val) => formatCompact(val) } 
                        } 
                    },
                    plugins: { 
                        tooltip: { 
                            callbacks: { 
                                label: (ctx) => `${ctx.dataset.label}: ${formatCurrency(ctx.raw)}` 
                            } 
                        }, 
                        legend: { position: 'top' } 
                    }
                }
            });
        }

        function renderFlowChart() {
            const ctx = document.getElementById('flowChart');
            if (!ctx || appState.results.length === 0) return;
            
            if (flowChartInstance) flowChartInstance.destroy();

            const final = appState.results[appState.results.length - 1];
            
            flowChartInstance = new Chart(ctx, {
                type: 'bar',
                data: { 
                    labels: ['Aportes', 'Saques'], 
                    datasets: [{ 
                        label: 'Fluxo', 
                        data: [final.accInvested, final.accWithdrawn], 
                        backgroundColor: ['#10b981', '#ef4444'], 
                        borderRadius: 8 
                    }] 
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } } 
                }
            });
        }

        function renderPieChart() {
            const ctx = document.getElementById('pieChart');
            if (!ctx || appState.results.length === 0) return;
            
            if (pieChartInstance) pieChartInstance.destroy();

            const final = appState.results[appState.results.length - 1];
            const pBalance = Math.max(0, final.principalBalance);
            const iBalance = Math.max(0, final.interestBalance);
            
            pieChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { 
                    labels: ['Principal', 'Juros'], 
                    datasets: [{ 
                        data: [pBalance, iBalance], 
                        backgroundColor: ['#6366f1', '#34d399'], 
                        borderWidth: 0 
                    }] 
                },
                options: { 
                    responsive: true, 
                    plugins: { legend: { position: 'bottom' } } 
                }
            });
        }

        // --- LÓGICA DA CALCULADORA BÁSICA ---

        let calcExpression = '';
        const display = document.getElementById('calcDisplay');

        function calcInput(val) {
            const ops = ['/', '*', '-', '+', '.'];
            if (ops.includes(val) && ops.includes(calcExpression.slice(-1))) {
                calcExpression = calcExpression.slice(0, -1) + val;
            } else {
                calcExpression += val;
            }
            display.value = calcExpression;
        }

        function calcClear() {
            calcExpression = '';
            display.value = '0';
        }

        function calcBackspace() {
            calcExpression = calcExpression.slice(0, -1);
            display.value = calcExpression || '0';
        }

        function calcResult() {
            try {
                if (/[^0-9+\-*/().]/.test(calcExpression)) {
                    throw new Error("Inválido");
                }
                const result = eval(calcExpression);
                if (!isFinite(result)) throw new Error("Erro");
                
                const formatted = Number.isInteger(result) ? result : result.toFixed(4).replace(/\.?0+$/, '');
                
                display.value = formatted;
                calcExpression = String(formatted);
            } catch (e) {
                display.value = "Erro";
                setTimeout(calcClear, 1500);
            }
        }

        // --- SINCRONIZAÇÃO (Import/Export - padrão template) ---

        function handleExport() {
            const dataStr = JSON.stringify(appState, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => {
                showToast('Dados copiados para a área de transferência!', 'success');
            }).catch(() => {
                // Fallback
                const area = document.getElementById('importDataTextarea');
                area.value = dataStr;
                area.select();
                document.execCommand('copy');
                area.value = '';
                showToast('Dados copiados (Fallback)!', 'success');
            });
        }

        function handleImport() {
            const str = document.getElementById('importDataTextarea').value.trim();
            if(!str) {
                showToast('Cole o código JSON primeiro.', 'error');
                return;
            }

            try {
                const parsed = JSON.parse(str);
                // Validação básica
                if (!parsed.config || !parsed.contributions) throw new Error("Formato inválido");

                if(confirm('Isso substituirá TODOS os dados atuais. Continuar?')) {
                    appState = parsed;
                    saveData();
                    updateUI();
                    document.getElementById('importDataTextarea').value = '';
                    showToast('Dados importados com sucesso!', 'success');
                }
            } catch (e) {
                showToast('Erro: JSON inválido.', 'error');
            }
        }

        // --- FUNÇÕES DE SIMULAÇÃO ---

        function saveSimulation() {
            const name = document.getElementById('simulationName').value.trim();
            if (!name) {
                showToast('Por favor, digite um nome para a simulação', 'error');
                return;
            }
            
            const simulations = JSON.parse(localStorage.getItem('finCalcSimulations') || '{}');
            simulations[name] = {
                config: appState.config,
                contributions: appState.contributions,
                withdrawals: appState.withdrawals,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('finCalcSimulations', JSON.stringify(simulations));
            document.getElementById('simulationName').value = '';
            updateSimulationList();
            showToast(`Simulação "${name}" salva com sucesso!`, 'success');
        }

        function loadSimulation() {
            const name = document.getElementById('loadSimulationSelect').value;
            if (!name) {
                showToast('Por favor, selecione uma simulação', 'error');
                return;
            }
            
            const simulations = JSON.parse(localStorage.getItem('finCalcSimulations') || '{}');
            const simulation = simulations[name];
            
            if (simulation) {
                appState.config = simulation.config;
                appState.contributions = simulation.contributions;
                appState.withdrawals = simulation.withdrawals;
                
                updateInputsFromState();
                renderContributions();
                renderWithdrawals();
                calculate();
                
                showToast(`Simulação "${name}" carregada com sucesso!`, 'success');
            }
        }

        function updateSimulationList() {
            const simulations = JSON.parse(localStorage.getItem('finCalcSimulations') || '{}');
            const select = document.getElementById('loadSimulationSelect');
            
            select.innerHTML = '<option value="">Selecione uma simulação...</option>';
            Object.keys(simulations).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }

        function updateInputsFromState() {
            document.getElementById('initialAmount').value = appState.config.initial;
            document.getElementById('interestRate').value = appState.config.rate;
            document.getElementById('periodValue').value = appState.config.periodValue;
            document.getElementById('periodUnit').value = appState.config.periodUnit;
            document.getElementById('inflationToggle').checked = appState.config.inflation;
            document.getElementById('inflationRate').value = appState.config.inflationRate;
            
            if(appState.config.inflation) {
                document.getElementById('inflationInputContainer').classList.remove('hidden');
            }
        }

        // --- INICIALIZAÇÃO (padrão template) ---

        document.addEventListener('DOMContentLoaded', () => {
            
            // Event Listeners UI (padrão template)
            initTabs();
            
            // Botões de Gráfico (padrão template)
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.chartType = btn.dataset.type;
                    renderMainChart();
                });
            });
            
            // Event Listeners Inputs
            document.getElementById('initialAmount').addEventListener('change', (e) => {
                appState.config.initial = parseFloat(e.target.value) || 0;
            });
            document.getElementById('interestRate').addEventListener('change', (e) => {
                appState.config.rate = parseFloat(e.target.value) || 0;
            });
            document.getElementById('periodValue').addEventListener('change', (e) => {
                appState.config.periodValue = parseFloat(e.target.value) || 0;
            });
            document.getElementById('periodUnit').addEventListener('change', (e) => {
                appState.config.periodUnit = e.target.value;
            });
            document.getElementById('inflationToggle').addEventListener('change', (e) => {
                appState.config.inflation = e.target.checked;
                document.getElementById('inflationInputContainer').classList.toggle('hidden', !e.target.checked);
            });
            document.getElementById('inflationRate').addEventListener('change', (e) => {
                appState.config.inflationRate = parseFloat(e.target.value) || 0;
            });

            // Event Listeners Principais
            document.getElementById('calculateBtn').addEventListener('click', calculate);
            document.getElementById('addContributionBtn').addEventListener('click', addContribution);
            document.getElementById('addWithdrawalBtn').addEventListener('click', addWithdrawal);
            document.getElementById('copyCsvButton').addEventListener('click', () => {
                const csvContent = "Mes;Juros;Aporte;Saque;Saldo\n" + 
                    appState.results.map(r => `${r.month};${r.interestMonth.toFixed(2)};${r.contribution.toFixed(2)};${r.withdrawal.toFixed(2)};${r.balance.toFixed(2)}`).join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "simulacao_financeira.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast('CSV exportado com sucesso!', 'success');
            });

            // Event Listeners Configurações (padrão template adaptado)
            document.getElementById('saveSimulationBtn').addEventListener('click', saveSimulation);
            document.getElementById('loadSimulationBtn').addEventListener('click', loadSimulation);
            document.getElementById('exportDataBtn').addEventListener('click', handleExport);
            document.getElementById('importDataBtn').addEventListener('click', handleImport);

            // Cópia do resultado da calculadora
            display.addEventListener('click', () => {
                if (display.value && display.value !== '0' && display.value !== 'Erro') {
                    navigator.clipboard.writeText(display.value).then(() => {
                        showToast('Resultado copiado para área de transferência!', 'success');
                    }).catch(() => {
                        showToast('Não foi possível copiar o resultado', 'error');
                    });
                }
            });

            // Carregar dados
            loadData();
            updateStorageBar();
            updateSimulationList();
            renderContributions();
            renderWithdrawals();
        });

        // Exports Globais (para o HTML chamar onclick se necessário) - padrão template
        window.removeContribution = removeContribution;
        window.removeWithdrawal = removeWithdrawal;
        window.updateContribution = updateContribution;
        window.updateWithdrawal = updateWithdrawal;
        window.calcInput = calcInput;
        window.calcClear = calcClear;
        window.calcBackspace = calcBackspace;
        window.calcResult = calcResult;

    </script>
</body>
</html>